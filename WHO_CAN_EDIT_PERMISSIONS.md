# 👑 من يمكنه تعديل الصلاحيات؟

## ✅ المدير الرئيسي (SuperAdmin) فقط

### الصلاحيات الكاملة:
- ✅ إضافة مدراء جدد
- ✅ تعديل بيانات أي مدير (الاسم، الهاتف، البريد)
- ✅ تغيير دور أي مدير (admin ↔ superadmin)
- ✅ تعديل صلاحيات أي مدير عادي
- ✅ تغيير كلمة مرور أي مدير
- ✅ حذف أي مدير

---

## ❌ المدير العادي (Admin)

### الصلاحيات المحدودة:
- ✅ عرض قائمة المدراء (للاطلاع فقط)
- ✅ عرض صلاحيات المدراء الآخرين
- ❌ **لا يمكنه** إضافة مدراء جدد
- ❌ **لا يمكنه** تعديل أي مدير
- ❌ **لا يمكنه** تغيير الصلاحيات
- ❌ **لا يمكنه** حذف مدراء

### ماذا يرى المدير العادي؟
عند دخوله لصفحة المدراء `/admin/admins`:
- 📋 قائمة بجميع المدراء
- 📊 الأدوار والصلاحيات لكل مدير
- ⚠️ رسالة تحذيرية: "للعرض فقط - فقط المدير الرئيسي يمكنه إضافة أو تعديل المدراء"
- 🔒 أزرار التعديل والحذف مخفية
- ❌ زر "إضافة مدير جديد" غير موجود

---

## 🔐 الحماية الأمنية

### في الواجهة الأمامية (Frontend):
```typescript
const { isSuperAdmin } = useAdminPermissions();

// إخفاء الأزرار
{isSuperAdmin && (
  <button>➕ إضافة مدير جديد</button>
)}

// فحص قبل التعديل
if (!isSuperAdmin) {
  alert('⛔ غير مصرح - فقط المدير الرئيسي!');
  return;
}
```

### في الخادم (Backend API):
```typescript
// في /api/admin/create-admin.ts
const currentAdminDoc = await admin.firestore()
  .collection('admins')
  .doc(uid)
  .get();

const currentAdminData = currentAdminDoc.data();

if (currentAdminData.role !== 'superadmin') {
  return res.status(403).json({ 
    error: 'Forbidden - Only SuperAdmin' 
  });
}
```

---

## 🎯 سيناريوهات الاستخدام

### سيناريو 1: المدير الرئيسي يريد إضافة موظف
1. ✅ يدخل لصفحة `/admin/admins`
2. ✅ يضغط "➕ إضافة مدير جديد"
3. ✅ يملأ البيانات
4. ✅ يختار الدور: "👤 مدير عادي"
5. ✅ يحدد الصلاحيات المطلوبة
6. ✅ يحفظ

### سيناريو 2: المدير العادي يريد إضافة موظف
1. ❌ يدخل لصفحة `/admin/admins`
2. ❌ لا يرى زر "إضافة مدير جديد"
3. ❌ يرى رسالة: "للعرض فقط"
4. ❌ لا يمكنه إضافة أو تعديل

### سيناريو 3: المدير العادي يحاول التعديل
1. ❌ يحاول الضغط على زر "تعديل" (غير موجود)
2. ❌ إذا حاول عبر الكود، يظهر تنبيه:
   - "⛔ غير مصرح - فقط المدير الرئيسي يمكنه تعديل المدراء!"
3. ❌ إذا حاول عبر API مباشرة، يحصل على:
   - `403 Forbidden - Only SuperAdmin`

---

## 📱 الواجهات المحدثة

### صفحة المدراء (`/admin/admins`):

#### للمدير الرئيسي:
```
┌─────────────────────────────────────────┐
│ 👥 المدراء | Admins                    │
│ إدارة حسابات المدراء في النظام          │
│                                         │
│ [➕ إضافة مدير جديد] [⬅ العودة]       │
└─────────────────────────────────────────┘

جدول المدراء:
┌────────┬────────────┬────────┬──────────┐
│ الاسم  │ البريد    │ الدور  │ الإجراءات│
├────────┼────────────┼────────┼──────────┤
│ أحمد   │ a@test.com │ 👑 رئيسي│ ✏️ 🗑️   │
│ محمد   │ m@test.com │ 👤 عادي │ ✏️ 🗑️   │
└────────┴────────────┴────────┴──────────┘
```

#### للمدير العادي:
```
┌─────────────────────────────────────────┐
│ 👥 المدراء | Admins                    │
│ إدارة حسابات المدراء في النظام          │
│                                         │
│ ⚠️ للعرض فقط - فقط المدير الرئيسي      │
│    يمكنه إضافة أو تعديل المدراء         │
│                                         │
│                        [⬅ العودة]      │
└─────────────────────────────────────────┘

جدول المدراء:
┌────────┬────────────┬────────┬──────────┐
│ الاسم  │ البريد    │ الدور  │ الإجراءات│
├────────┼────────────┼────────┼──────────┤
│ أحمد   │ a@test.com │ 👑 رئيسي│ 🔒 للعرض│
│ محمد   │ m@test.com │ 👤 عادي │ 🔒 للعرض│
└────────┴────────────┴────────┴──────────┘
```

---

## ✨ الميزات الأمنية المطبقة

1. **حماية مزدوجة**: Frontend + Backend
2. **رسائل واضحة**: للمدراء العاديين عند محاولة الوصول
3. **إخفاء تلقائي**: للأزرار والخيارات غير المصرح بها
4. **توكن مصادقة**: كل طلب API يتطلب توكن SuperAdmin
5. **فحص الدور**: في كل عملية (إضافة، تعديل، حذف)

---

## 🚀 الخلاصة

| العملية | المدير الرئيسي | المدير العادي |
|---------|----------------|----------------|
| إضافة مدير جديد | ✅ نعم | ❌ لا |
| تعديل مدير | ✅ نعم | ❌ لا |
| حذف مدير | ✅ نعم | ❌ لا |
| تغيير الصلاحيات | ✅ نعم | ❌ لا |
| تغيير الدور | ✅ نعم | ❌ لا |
| عرض المدراء | ✅ نعم | ✅ نعم |

**القاعدة الذهبية**: 
> 👑 فقط المدير الرئيسي (SuperAdmin) يستطيع التحكم بالمدراء والصلاحيات

---

**آخر تحديث**: 31 أكتوبر 2025
